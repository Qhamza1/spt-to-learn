<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPT TO LEARN - LIVE</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --primary: #6366f1; --teacher: #2ecc71; --dark: #2c3e50; }
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 100%; max-width: 450px; margin-top: 20px; }
        .main-title { color: #5c6bc0; font-size: 35px; font-weight: 900; margin-bottom: 10px; text-align: center; }
        input { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; text-align: right; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; color: white; margin-top: 10px; font-size: 18px; }
        .btn-teacher { background: var(--teacher); }
        .btn-dark { background: var(--dark); }
        .btn-back { background: #94a3b8; margin-top: 20px; }
        .section { display: none; width: 100%; max-width: 450px; }
        .active { display: block; }
        .student-item { background: #f8fafc; padding: 15px; border-radius: 15px; margin-bottom: 10px; border-right: 5px solid var(--primary); text-align: right; }
        .st-controls { display: flex; gap: 5px; margin-top: 10px; }
        .st-btn { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
        .active-p { background: #2ecc71 !important; color: white; }
        .active-m { background: #f39c12 !important; color: white; }
    </style>
</head>
<body>

    <div class="main-title">SPT TO LEARN</div>

    <div id="home" class="section active">
        <div class="card">
            <button class="btn btn-teacher" onclick="navigateTo('teacher-reg')">ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ù„Ù… Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn btn-dark" onclick="navigateTo('login')">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </div>
    </div>

    <div id="teacher-reg" class="section">
        <div class="card">
            <h3>Ø­Ø³Ø§Ø¨ Ù…Ø¹Ù„Ù… Ø¬Ø¯ÙŠØ¯ (Ø³Ø­Ø§Ø¨ÙŠ)</h3>
            <input type="text" id="t-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
            <input type="password" id="t-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn btn-teacher" onclick="processReg()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</button>
            <button class="btn btn-back" onclick="navigateTo('home')">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>

    <div id="login" class="section">
        <div class="card">
            <h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <input type="text" id="l-code" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ (SPT-...)">
            <input type="password" id="l-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± (Ù„Ù„Ù…Ø¹Ù„Ù… ÙÙ‚Ø·)">
            <button class="btn btn-dark" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
            <button class="btn btn-back" onclick="navigateTo('home')">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>

    <div id="teacher-dash" class="section">
        <div class="card">
            <h3 id="t-welcome">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</h3>
            <div style="background: #eef2ff; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <input type="text" id="st-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                <button class="btn btn-dark" style="padding:10px;" onclick="addStudent()">+ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø­Ø§Ø¨Ø©</button>
            </div>
            <div id="students-list"></div>
            <button class="btn btn-teacher" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸ ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</button>
            <button class="btn btn-back" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div id="student-dash" class="section">
        <div class="card">
            <h3 id="s-welcome">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
            <div id="student-report"></div>
            <button class="btn btn-back" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const firebaseConfig = { databaseURL: "https://spt-to-learn-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentTeacherCode = "";
        let studentsData = [];

        function navigateTo(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function processReg() {
            const name = document.getElementById('t-name').value;
            const pass = document.getElementById('t-pass').value;
            if (!name || !pass) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            const code = "SPT-T" + Math.random().toString(36).substr(2, 4).toUpperCase();
            db.ref('users/' + code).set({name, pass, role: 'teacher', students: []}).then(() => {
                alert("ØªÙ…! ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ù‡Ùˆ: " + code);
                navigateTo('login');
            });
        }

        function handleLogin() {
            const code = document.getElementById('l-code').value.toUpperCase();
            const pass = document.getElementById('l-pass').value;
            db.ref('users/' + code).once('value').then((snapshot) => {
                const user = snapshot.val();
                if (user) {
                    if (user.role === 'teacher' && user.pass === pass) {
                        currentTeacherCode = code;
                        studentsData = user.students || [];
                        document.getElementById('t-welcome').innerText = "Ø£Ù‡Ù„Ø§Ù‹ Ø£/ " + user.name;
                        renderTeacherList();
                        navigateTo('teacher-dash');
                    } else if (user.role === 'student') {
                        renderStudentReport(user);
                        navigateTo('student-dash');
                    } else { alert("ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§Ø·Ø¦Ø©"); }
                } else { alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©"); }
            });
        }

        function addStudent() {
            const name = document.getElementById('st-name-input').value;
            if (!name) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨");
            const sCode = "SPT-S" + Math.random().toString(36).substr(2, 4).toUpperCase();
            const newSt = { name, code: sCode, role: 'student', present: false, paid: false, grade: "" };
            studentsData.push(newSt);
            db.ref('users/' + sCode).set(newSt);
            renderTeacherList();
            alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©! ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: " + sCode);
            document.getElementById('st-name-input').value = "";
        }

        function renderTeacherList() {
            const list = document.getElementById('students-list');
            list.innerHTML = "<h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨:</h4>";
            studentsData.forEach((s, idx) => {
                const div = document.createElement('div');
                div.className = 'student-item';
                div.innerHTML = `
                    <strong>${s.name}</strong> <small>(ÙƒÙˆØ¯: ${s.code})</small>
                    <div class="st-controls">
                        <button class="st-btn ${s.present ? 'active-p' : ''}" onclick="toggleSt(${idx}, 'present')">Ø­Ø¶ÙˆØ±</button>
                        <button class="st-btn ${s.paid ? 'active-m' : ''}" onclick="toggleSt(${idx}, 'paid')">Ù…ØµØ§Ø±ÙŠÙ</button>
                        <input type="number" value="${s.grade}" style="width:50px;" onchange="updateSt(${idx}, this.value)">
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function toggleSt(idx, key) {
            studentsData[idx][key] = !studentsData[idx][key];
            renderTeacherList();
        }

        function updateSt(idx, val) { studentsData[idx].grade = val; }

        function saveData() {
            db.ref('users/' + currentTeacherCode + '/students').set(studentsData);
            studentsData.forEach(s => db.ref('users/' + s.code).set(s));
            alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­!");
        }

        function renderStudentReport(user) {
            document.getElementById('s-welcome').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + user.name;
            document.getElementById('student-report').innerHTML = `
                <div class="student-item">
                    <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${user.present ? 'Ø­Ø§Ø¶Ø± âœ…' : 'ØºØ§Ø¦Ø¨ âŒ'}</p>
                    <p>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ: ${user.paid ? 'Ù…Ø¯ÙÙˆØ¹Ø© ğŸ’°' : 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©'}</p>
                    <h2>Ø§Ù„Ø¯Ø±Ø¬Ø©: ${user.grade || '---'}</h2>
                </div>
            `;
        }
    </script>
</body>
</html>
 
